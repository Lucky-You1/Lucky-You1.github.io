<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>ğŸ’“ æµªæ¼«ç»½æ”¾</title>
    <style>
      /* å¼•å¯¼å¼¹æ¡† */
      .guide-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80%;
        max-width: 350px;
        padding: 25px 20px;
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
        z-index: 10000;
        text-align: center;
        box-sizing: border-box;
      }
      .guide-popup p {
        font-family: "æ¥·ä½“", "KaiTi", serif;
        font-size: 18px;
        color: #333;
        margin: 0 0 20px 0;
        line-height: 1.5;
      }
      .guide-btn {
        padding: 15px 45px;
        background: #ff8ba7;
        color: #fff;
        border: none;
        border-radius: 30px;
        font-family: "æ¥·ä½“", "KaiTi", serif;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s;
        width: 80%;
        max-width: 220px;
        box-sizing: border-box;
        display: block;
        margin: 0 auto;
      }
      .guide-btn:active {
        background: #ff6b8f;
        transform: scale(0.98);
      }

      /* å…³å¿ƒå¼¹çª—æ ·å¼ */
      .popup {
        position: fixed;
        padding: 15px 20px;
        border-radius: 12px;
        font-family: "æ¥·ä½“", "KaiTi", serif;
        font-size: 16px;
        color: #333;
        z-index: 9999;
        box-sizing: border-box;
        transition: all 1.2s cubic-bezier(0.17, 0.67, 0.83, 0.67); /* çˆ†ç‚¸åŠ¨ç”»æ›´å¿«æ›´çŒ› */
      }
      .popup.gather {
        transform: scale(0.3);
        opacity: 0.8;
        transition: all 1.5s cubic-bezier(0.34, 1.56, 0.64, 1); /* èšé›†åŠ¨ç”»å¹³æ»‘ */
      }
      .popup.explode {
        transform: scale(1.8) translate(var(--x, 0), var(--y, 0));
        opacity: 0;
      }

      /* çƒŸèŠ±å®¹å™¨ */
      #fireworks {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10002;
        pointer-events: none;
      }

      /* å°ç”·å­©æŠ±èŠ±åœºæ™¯ï¼ˆé»˜è®¤éšè—ï¼‰ */
      .boy-scene {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10003;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        pointer-events: none;
        opacity: 0;
        transition: opacity 1.5s ease;
      }
      .boy-scene.show {
        opacity: 1;
      }
      .boy-img {
        width: 180px;
        height: auto;
        margin-bottom: 20px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .boy-text {
        font-family: "æ¥·ä½“", "KaiTi", serif;
        font-size: 24px;
        color: #ff6b8f;
        background: rgba(255, 255, 255, 0.8);
        padding: 10px 30px;
        border-radius: 50px;
        box-shadow: 0 3px 10px rgba(255, 107, 143, 0.3);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.8);
        }
        to {
          opacity: 0.9;
          transform: scale(1);
        }
      }

      body {
        margin: 0;
        overflow: hidden;
        background: #fff;
        touch-action: manipulation;
      }
    </style>
  </head>
  <body>
    <!-- å¼•å¯¼å¼¹æ¡† -->
    <div class="guide-popup" id="guidePopup">
      <p>å‡†å¤‡å¥½å¼€å§‹æµªæ¼«ä¹‹æ—…äº†å—ï¼Ÿ</p>
      <button class="guide-btn" id="startBtn">å‡†å¤‡å¥½äº†ï¼</button>
    </div>
    <!-- çƒŸèŠ±ç”»å¸ƒ -->
    <canvas id="fireworks"></canvas>
    <!-- å°ç”·å­©æŠ±èŠ±åœºæ™¯ï¼ˆé»˜è®¤éšè—ï¼‰ -->
    <div class="boy-scene" id="boyScene">
      <div class="boy-text">è¦å¼€å¿ƒå‘€ï¼</div>
    </div>

    <script>
      const baseTips = [
        "å¥½å¥½åƒé¥­å‘€",
        "å¤šå–æ¸©å¼€æ°´",
        "å¤©å†·åŠ ä»¶è¡£",
        "åˆ«ç†¬å¤œå•¦",
        "è®°å¾—åƒæ°´æœ",
        "ç´¯äº†æ­‡ä¸€æ­‡",
        "å‡ºé—¨å¸¦ä¼å“¦",
        "æ—©ç‚¹ä¼‘æ¯å§",
        "æŒ‰æ—¶åƒæ—©é¤",
        "å°‘çœ‹ä¼šå„¿æ‰‹æœº",
        "èµ°è·¯æ…¢ç‚¹å‘€",
        "ç¡å‰æ³¡æ³¡è„š",
        "åˆ«åƒå¤ªå‡‰çš„",
        "ä¿æŒå¥½å¿ƒæƒ…",
        "å·¥ä½œåˆ«å¤ªç´¯",
        "å¤šå‡ºå»èµ°èµ°",
        "è®°å¾—æ¶‚é˜²æ™’",
        "é¥­è¦è¶çƒ­åƒ",
        "åˆ«ç»™è‡ªå·±å‹åŠ›",
        "å¤©å†·ç©¿è¢œå­",
        "å¤šåƒè”¬èœå‘€",
        "æ—©ç‚¹å›å®¶å“¦",
        "åˆ«ä¹…åå‘€",
        "ç¬‘ä¸€ç¬‘å‘€",
        "æ³¨æ„ä¿æš–å‘€",
        "åˆ«åƒå¤ªè¾£å•¦",
        "ç´¯äº†ä¼¸ä¼¸è…°",
        "ç¡å‰åˆ«ç©æ‰‹æœº",
        "è®°å¾—åˆä¼‘å“¦",
        "è¦ä¿æŒå¥½å¿ƒæƒ…",
      ];
      const bgColors = [
        "lightpink",
        "skyblue",
        "lightgreen",
        "lavender",
        "lightyellow",
        "plum",
        "coral",
        "bisque",
        "aquamarine",
        "mistyrose",
        "honeydew",
      ];
      // èŠ±æœµé¢œè‰²ï¼ˆæ›´é²œè‰³ï¼Œå¤šè‰²ç³»æ­é…ï¼‰
      const flowerColors = [
        // ç²‰è‰²ç³»
        { main: "#ff8ba7", petal: "#ff6b8f", center: "#ff4d79" },
        { main: "#ffb6c1", petal: "#ff9aa2", center: "#ff7b7b" },
        // è“è‰²ç³»
        { main: "#87ceeb", petal: "#64b5f6", center: "#42a5f5" },
        { main: "#b3e0ff", petal: "#91d5ff", center: "#64b5f6" },
        // é»„è‰²ç³»
        { main: "#fff3e0", petal: "#ffe0b2", center: "#ffcc80" },
        { main: "#fff9c4", petal: "#fff59d", center: "#ffee58" },
        // ç´«è‰²ç³»
        { main: "#e1bee7", petal: "#ce93d8", center: "#ba68c8" },
        { main: "#f3e5f5", petal: "#e1bee7", center: "#d1c4e9" },
        // çº¢è‰²ç³»
        { main: "#ffcdcd", petal: "#ff9e9e", center: "#ff6e6e" },
        { main: "#ffb3ba", petal: "#ff8a95", center: "#ff5e6c" },
      ];
      const centerX = window.innerWidth / 2;
      const centerY = window.innerHeight / 2;
      let popups = [];
      const boyScene = document.getElementById("boyScene");

      // é¢„åŠ è½½å°ç”·å­©å›¾ç‰‡
      function preloadBoyImage() {
        const img = new Image();
        img.src =
          "https://cdn.staticaly.com/gh/liyupi/pic-lib/blob/main/boy-hold-flower.png";
      }
      window.addEventListener("load", preloadBoyImage);

      // ç”Ÿæˆå•ä¸ªå¼¹çª—
      function createPopup() {
        const popup = document.createElement("div");
        popup.className = "popup";
        popup.textContent =
          baseTips[Math.floor(Math.random() * baseTips.length)];
        popup.style.backgroundColor =
          bgColors[Math.floor(Math.random() * bgColors.length)];

        const screenWidth = window.innerWidth;
        const screenHeight = window.innerHeight;
        const popupWidth = 140;
        const popupHeight = 55;
        const x = Math.random() * (screenWidth - popupWidth);
        const y = Math.random() * (screenHeight - popupHeight);

        popup.dataset.initX = x;
        popup.dataset.initY = y;
        popup.style.left = `${x}px`;
        popup.style.top = `${y}px`;
        popup.style.animation = "fadeIn 0.5s ease-out";

        document.body.appendChild(popup);
        return popup;
      }

      // èšé›†åŠ¨ç”»ï¼šæ‰€æœ‰å¼¹çª—èšåˆ°ä¸­å¿ƒ
      function gatherPopups() {
        popups.forEach((popup) => {
          popup.style.left = `${centerX - 70}px`; // å¼¹çª—ä¸­å¿ƒå¯¹é½å±å¹•ä¸­å¿ƒ
          popup.style.top = `${centerY - 27.5}px`;
          popup.classList.add("gather");
        });
      }

      // åŒæ­¥çˆ†ç‚¸ï¼šå¼¹çª—+èŠ±æœµçƒŸèŠ±åŒä¸€æ—¶é—´çˆ†ç‚¸
      function syncExplode() {
        // 1. å¼¹çª—çˆ†ç‚¸ï¼ˆä¸çƒŸèŠ±åŒæ—¶è§¦å‘ï¼‰
        popups.forEach((popup) => {
          const initX = parseFloat(popup.dataset.initX);
          const initY = parseFloat(popup.dataset.initY);
          // è®¡ç®—ä»ä¸­å¿ƒåˆ°åˆå§‹ä½ç½®çš„åå‘åç§»ï¼ˆæœ€å¤§åŒ–çˆ†ç‚¸æ‰©æ•£ï¼‰
          const offsetX = (initX - centerX + 70) * (1.2 + Math.random() * 0.8);
          const offsetY =
            (initY - centerY + 27.5) * (1.2 + Math.random() * 0.8);
          popup.style.setProperty("--x", `${offsetX}px`);
          popup.style.setProperty("--y", `${offsetY}px`);
          popup.classList.remove("gather");
          popup.classList.add("explode");
        });

        // 2. èŠ±æœµçƒŸèŠ±çˆ†ç‚¸ï¼ˆä¸å¼¹çª—çˆ†ç‚¸åŒæ­¥å¯åŠ¨ï¼‰
        startFlowerFireworks(() => {
          // èŠ±æœµåŠ¨ç”»ç»“æŸåï¼Œæ˜¾ç¤ºå°ç”·å­©åœºæ™¯
        });

        // 3. çˆ†ç‚¸åæ¸…ç†å¼¹çª—
        setTimeout(() => {
          popups.forEach((popup) => popup.remove());
          popups = [];
        }, 1200); // ä¸å¼¹çª—çˆ†ç‚¸åŠ¨ç”»æ—¶é•¿ä¸€è‡´
      }

      // èŠ±æœµçƒŸèŠ±ï¼šä¸­å¿ƒç›´æ¥çˆ†ç‚¸ï¼Œç²’å­ä¸ºå¤šç“£èŠ±æœµå½¢çŠ¶ï¼ˆæ·»åŠ ç»“æŸå›è°ƒï¼‰
      function startFlowerFireworks(onComplete) {
        const canvas = document.getElementById("fireworks");
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const flowers = [];
        let animationFrameId;

        // ç”ŸæˆèŠ±æœµç²’å­ï¼ˆä¸­å¿ƒçˆ†ç‚¸ï¼Œå¤šæ³¢æ¬¡ï¼‰
        function createFlowers() {
          // ç¬¬ä¸€æ³¢ï¼šä¸­å¿ƒå¯†é›†çˆ†ç‚¸ï¼ˆ250æœµèŠ±ï¼‰
          for (let i = 0; i < 250; i++) {
            const angle = Math.random() * Math.PI * 2; // 360åº¦éšæœºæ–¹å‘
            const speed = 2 + Math.random() * 5; // éšæœºé€Ÿåº¦
            const color =
              flowerColors[Math.floor(Math.random() * flowerColors.length)];
            const size = 8 + Math.random() * 6; // èŠ±æœµå¤§å°ï¼ˆæ¯”èŠ±ç“£å¤§ï¼Œæ›´é†’ç›®ï¼‰
            const petalCount = 6 + Math.floor(Math.random() * 3); // èŠ±ç“£æ•°é‡ï¼ˆ6-8ç“£ï¼Œæ›´çœŸå®ï¼‰

            flowers.push({
              x: centerX,
              y: centerY,
              vx: Math.cos(angle) * speed,
              vy: Math.sin(angle) * speed,
              color: color,
              alpha: 1,
              decay: 0.005 + Math.random() * 0.003, // ç¼“æ…¢è¡°å‡ï¼Œå»¶é•¿æ˜¾ç¤ºæ—¶é—´
              size: size,
              petalCount: petalCount,
              rotateSpeed: (Math.random() - 0.5) * 0.02, // éšæœºæ—‹è½¬é€Ÿåº¦
            });
          }

          // ç¬¬äºŒæ³¢ï¼šå»¶è¿Ÿ300mså†ç‚¸ä¸€æ³¢ï¼ˆ150æœµèŠ±ï¼‰ï¼Œçˆ†ç‚¸èŒƒå›´æ›´å¤§
          setTimeout(() => {
            for (let i = 0; i < 150; i++) {
              const angle = Math.random() * Math.PI * 2;
              const speed = 3 + Math.random() * 6;
              const color =
                flowerColors[Math.floor(Math.random() * flowerColors.length)];
              const size = 7 + Math.random() * 5;
              const petalCount = 6 + Math.floor(Math.random() * 3);

              flowers.push({
                x: centerX,
                y: centerY,
                vx: Math.cos(angle) * speed,
                vy: Math.sin(angle) * speed,
                color: color,
                alpha: 0.9,
                decay: 0.004 + Math.random() * 0.002,
                size: size,
                petalCount: petalCount,
                rotateSpeed: (Math.random() - 0.5) * 0.02,
              });
            }
          }, 300);
        }

        // ç»˜åˆ¶å¤šç“£èŠ±æœµï¼ˆæ ¸å¿ƒä¼˜åŒ–ï¼šæ›´é€¼çœŸçš„èŠ±æœµå½¢æ€ï¼‰
        function drawFlower(
          ctx,
          x,
          y,
          size,
          color,
          alpha,
          petalCount,
          rotateAngle
        ) {
          ctx.save();
          ctx.translate(x, y);
          ctx.rotate(rotateAngle); // èŠ±æœµæ—‹è½¬ï¼Œæ›´è‡ªç„¶
          ctx.globalAlpha = alpha;

          const petalSize = size * 0.6; // èŠ±ç“£å¤§å°
          const centerSize = size * 0.3; // èŠ±è•Šå¤§å°

          // ç»˜åˆ¶èŠ±ç“£ï¼ˆå¤šç“£ç¯ç»•ï¼‰
          for (let i = 0; i < petalCount; i++) {
            const angle = (i / petalCount) * Math.PI * 2;
            ctx.save();
            ctx.rotate(angle);

            // ç»˜åˆ¶å•ä¸ªèŠ±ç“£ï¼ˆæ¤­åœ†+åœ†å¼§ï¼Œæ›´é¥±æ»¡ï¼‰
            ctx.beginPath();
            ctx.ellipse(
              petalSize * 0.5,
              0,
              petalSize,
              petalSize * 0.7,
              0,
              0,
              Math.PI * 2
            );
            ctx.fillStyle = color.petal;
            ctx.fill();

            ctx.restore();
          }

          // ç»˜åˆ¶èŠ±è•Šï¼ˆä¸­å¿ƒåœ†ç‚¹ï¼Œé¢œè‰²æ›´æ·±ï¼‰
          ctx.beginPath();
          ctx.arc(0, 0, centerSize, 0, Math.PI * 2);
          ctx.fillStyle = color.center;
          ctx.fill();

          ctx.restore();
        }

        // èŠ±æœµåŠ¨ç”»å¾ªç¯ï¼ˆè‡ªç„¶é£˜è½æ•ˆæœï¼‰
        function animateFlowers() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          flowers.forEach((flower, index) => {
            // èŠ±æœµè¿åŠ¨ï¼šæ·»åŠ é‡åŠ›+éšæœºæ‘†åŠ¨ï¼Œæ¨¡æ‹Ÿè‡ªç„¶é£˜è½
            flower.vy += 0.04; // é‡åŠ›ä¸‹è½
            flower.vx += (Math.random() - 0.5) * 0.05; // å·¦å³è½»å¾®æ‘†åŠ¨
            flower.x += flower.vx;
            flower.y += flower.vy;
            flower.alpha -= flower.decay;
            flower.rotateAngle = (flower.rotateAngle || 0) + flower.rotateSpeed; // æŒç»­æ—‹è½¬

            // ç»˜åˆ¶èŠ±æœµ
            drawFlower(
              ctx,
              flower.x,
              flower.y,
              flower.size,
              flower.color,
              flower.alpha,
              flower.petalCount,
              flower.rotateAngle
            );

            // ç§»é™¤æ¶ˆå¤±çš„èŠ±æœµ
            if (flower.alpha <= 0 || flower.y > canvas.height + flower.size) {
              flowers.splice(index, 1);
            }
          });

          // æŒç»­åŠ¨ç”»ç›´åˆ°æ‰€æœ‰èŠ±æœµæ¶ˆå¤±ï¼ˆæ€»æ—¶é•¿çº¦10ç§’ï¼‰
          if (flowers.length > 0) {
            animationFrameId = requestAnimationFrame(animateFlowers);
          } else {
            cancelAnimationFrame(animationFrameId);
            setTimeout(() => {
              ctx.clearRect(0, 0, canvas.width, canvas.height);
              onComplete && onComplete(); // èŠ±æœµåŠ¨ç”»ç»“æŸï¼Œæ‰§è¡Œå›è°ƒæ˜¾ç¤ºå°ç”·å­©
            }, 500);
          }
        }

        createFlowers();
        animateFlowers();
        setTimeout(()=>{
        boyScene.classList.add("show");

        },1000)
      }

      // å®Œæ•´æµç¨‹ï¼šå¼•å¯¼â†’ç”Ÿæˆâ†’èšé›†â†’åŒæ­¥çˆ†ç‚¸â†’æ˜¾ç¤ºå°ç”·å­©
      function startPopup() {
        document.getElementById("guidePopup").style.display = "none";
        popups = [];

        // ç”Ÿæˆ100ä¸ªå¼¹çª—ï¼ˆä¼˜åŒ–æ•°é‡ï¼Œé¿å…æ‰‹æœºå¡é¡¿ï¼‰
        const windowCount = 100;
        for (let i = 0; i < windowCount; i++) {
          setTimeout(() => {
            const popup = createPopup();
            popups.push(popup);
          }, i * 100);
        }

        const totalGenerateTime = windowCount * 100; // 10ç§’ç”Ÿæˆå®Œæ‰€æœ‰å¼¹çª—
        setTimeout(gatherPopups, totalGenerateTime + 800); // ç”Ÿæˆåå»¶è¿Ÿ0.8ç§’å¼€å§‹èšé›†
        setTimeout(syncExplode, totalGenerateTime + 800 + 1800); // èšé›†1.8ç§’åï¼ŒåŒæ­¥è§¦å‘çˆ†ç‚¸
      }

      // ç»‘å®šæŒ‰é’®äº‹ä»¶ï¼ˆç¡®ä¿æ‰‹æœºç«¯ç‚¹å‡»æœ‰æ•ˆï¼‰
      document.addEventListener("DOMContentLoaded", () => {
        const startBtn = document.getElementById("startBtn");
        startBtn.addEventListener("click", startPopup);
        startBtn.addEventListener("touchstart", (e) => {
          e.preventDefault();
          startPopup();
        });
      });
    </script>
  </body>
</html>
